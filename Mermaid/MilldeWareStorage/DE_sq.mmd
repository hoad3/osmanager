sequenceDiagram
    participant User as User
    participant Middleware as MiddlewareStorage
    participant FileSys as File System
    participant AES as AES(CBC)
    participant SHA256 as SHA-256

    User->>Middleware: DecryptFromFile(filePath)

    Note over Middleware: 1. Đọc file đã mã hóa
    Middleware->>FileSys: ReadAllBytes(filePath)
    FileSys-->>Middleware: [IV + ciphertext]

    Note over Middleware: 2. Tách dữ liệu
    Middleware->>Middleware: Extract IV (16 bytes)
    Middleware->>Middleware: Extract ciphertext

    Note over Middleware: 3. Chuẩn bị AES để giải mã
    Middleware->>SHA256: Get _key (đã tạo từ constructor)
    SHA256-->>Middleware: 32-byte Key
    Middleware->>AES: Create AES instance
    AES-->>Middleware: AES object
    Middleware->>AES: aes.Key = _key
    Middleware->>AES: aes.IV = IV
    Middleware->>AES: aes.Mode = CBC

    Note over Middleware: 4. Giải mã ciphertext
    Middleware->>AES: CreateDecryptor(Key, IV)
    AES-->>Middleware: decryptor
    Middleware->>AES: Decrypt(ciphertext)
    AES-->>Middleware: plaintext

    Middleware-->>User: Trả về plaintext
